var e="object"==typeof global&&global&&global.Object===Object&&global,t="object"==typeof self&&self&&self.Object===Object&&self,r=e||t||Function("return this")(),o=r.Symbol,n=Object.prototype,c=n.hasOwnProperty,a=n.toString,i=o?o.toStringTag:void 0;var u=Object.prototype.toString;var l="[object Null]",s="[object Undefined]",b=o?o.toStringTag:void 0;function p(e){return null==e?void 0===e?s:l:b&&b in Object(e)?function(e){var t=c.call(e,i),r=e[i];try{e[i]=void 0;var o=!0}catch(e){}var n=a.call(e);return o&&(t?e[i]=r:delete e[i]),n}(e):function(e){return u.call(e)}(e)}function f(e){return null!=e&&"object"==typeof e}var y=Array.isArray;function j(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var d="[object AsyncFunction]",v="[object Function]",m="[object GeneratorFunction]",g="[object Proxy]";function w(e){if(!j(e))return!1;var t=p(e);return t==v||t==m||t==d||t==g}var O,h=r["__core-js_shared__"],S=(O=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"";var A=Function.prototype.toString;function x(e){if(null!=e){try{return A.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var _=/^\[object .+?Constructor\]$/,P=Function.prototype,E=Object.prototype,F=P.toString,U=E.hasOwnProperty,M=RegExp("^"+F.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function T(e){return!(!j(e)||(t=e,S&&S in t))&&(w(e)?M:_).test(x(e));var t}function B(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return T(r)?r:void 0}var k=B(r,"WeakMap"),I=9007199254740991;function $(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=I}var D=Object.prototype;function R(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||D)}function q(e){return f(e)&&"[object Arguments]"==p(e)}var V=Object.prototype,W=V.hasOwnProperty,C=V.propertyIsEnumerable,L=q(function(){return arguments}())?q:function(e){return f(e)&&W.call(e,"callee")&&!C.call(e,"callee")};var N="object"==typeof exports&&exports&&!exports.nodeType&&exports,z=N&&"object"==typeof module&&module&&!module.nodeType&&module,G=z&&z.exports===N?r.Buffer:void 0,K=(G?G.isBuffer:void 0)||function(){return!1},Q={};Q["[object Float32Array]"]=Q["[object Float64Array]"]=Q["[object Int8Array]"]=Q["[object Int16Array]"]=Q["[object Int32Array]"]=Q["[object Uint8Array]"]=Q["[object Uint8ClampedArray]"]=Q["[object Uint16Array]"]=Q["[object Uint32Array]"]=!0,Q["[object Arguments]"]=Q["[object Array]"]=Q["[object ArrayBuffer]"]=Q["[object Boolean]"]=Q["[object DataView]"]=Q["[object Date]"]=Q["[object Error]"]=Q["[object Function]"]=Q["[object Map]"]=Q["[object Number]"]=Q["[object Object]"]=Q["[object RegExp]"]=Q["[object Set]"]=Q["[object String]"]=Q["[object WeakMap]"]=!1;var Y,H="object"==typeof exports&&exports&&!exports.nodeType&&exports,J=H&&"object"==typeof module&&module&&!module.nodeType&&module,X=J&&J.exports===H&&e.process,Z=function(){try{var e=J&&J.require&&J.require("util").types;return e||X&&X.binding&&X.binding("util")}catch(e){}}(),ee=Z&&Z.isTypedArray,te=ee?(Y=ee,function(e){return Y(e)}):function(e){return f(e)&&$(e.length)&&!!Q[p(e)]};var re=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),oe=Object.prototype.hasOwnProperty;var ne=B(r,"Map"),ce=B(r,"DataView"),ae=B(r,"Promise"),ie=B(r,"Set"),ue="[object Map]",le="[object Promise]",se="[object Set]",be="[object WeakMap]",pe="[object DataView]",fe=x(ce),ye=x(ne),je=x(ae),de=x(ie),ve=x(k),me=p;(ce&&me(new ce(new ArrayBuffer(1)))!=pe||ne&&me(new ne)!=ue||ae&&me(ae.resolve())!=le||ie&&me(new ie)!=se||k&&me(new k)!=be)&&(me=function(e){var t=p(e),r="[object Object]"==t?e.constructor:void 0,o=r?x(r):"";if(o)switch(o){case fe:return pe;case ye:return ue;case je:return le;case de:return se;case ve:return be}return t});var ge=me,we=Object.prototype.hasOwnProperty;function Oe(e){if(null==e)return!0;if(function(e){return null!=e&&$(e.length)&&!w(e)}(e)&&(y(e)||"string"==typeof e||"function"==typeof e.splice||K(e)||te(e)||L(e)))return!e.length;var t=ge(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(R(e))return!function(e){if(!R(e))return re(e);var t=[];for(var r in Object(e))oe.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e).length;for(var r in e)if(we.call(e,r))return!1;return!0}var he={id:"operation-add-editor",handler:async({email:e,localteam_id:t},{env:r,logger:o,accountability:n,services:c,getSchema:a})=>{n.admin=!0,o.info(e,"email"),o.info(t,"localteam_id");const{UsersService:i,RolesService:u,MailService:l,ItemsService:s}=c,b=await a();new s("junction_directus_users_localteams",{schema:b,accountability:n});const p=new i({schema:b}),f=new u({schema:b,accountability:n}),y=new l({schema:b,accountability:n});p.validateEmail(e);let j=p.inviteUrl(e);const d=await p.getUserByEmail(e);if(!Oe(d))throw new Error("User already exist2");{const r=await f.readByQuery({fields:["*"],filter:{name:{_eq:"EditorLocalteam"}}});o.info(r[0].id),await p.createOne({email:e,role:r[0].id,status:"invited",localteams:[{localteam_id:t}]});const n="You've been invited to participate in Stadt-Land-Klima";await y.send({to:d?.email??e,subject:n,template:{name:"user-invitation",data:{url:j,email:e}}})}o.info(j,"url")}};export{he as default};
