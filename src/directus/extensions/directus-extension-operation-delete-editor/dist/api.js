var e="object"==typeof global&&global&&global.Object===Object&&global,t="object"==typeof self&&self&&self.Object===Object&&self,r=e||t||Function("return this")(),o=r.Symbol,n=Object.prototype,c=n.hasOwnProperty,a=n.toString,i=o?o.toStringTag:void 0;var u=Object.prototype.toString;var l="[object Null]",b="[object Undefined]",s=o?o.toStringTag:void 0;function f(e){return null==e?void 0===e?b:l:s&&s in Object(e)?function(e){var t=c.call(e,i),r=e[i];try{e[i]=void 0;var o=!0}catch(e){}var n=a.call(e);return o&&(t?e[i]=r:delete e[i]),n}(e):function(e){return u.call(e)}(e)}function p(e){return null!=e&&"object"==typeof e}var y=Array.isArray;function j(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var v="[object AsyncFunction]",d="[object Function]",g="[object GeneratorFunction]",m="[object Proxy]";function O(e){if(!j(e))return!1;var t=f(e);return t==d||t==g||t==v||t==m}var h,w=r["__core-js_shared__"],A=(h=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"";var S=Function.prototype.toString;function x(e){if(null!=e){try{return S.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var P=/^\[object .+?Constructor\]$/,F=Function.prototype,M=Object.prototype,T=F.toString,U=M.hasOwnProperty,k=RegExp("^"+T.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function E(e){return!(!j(e)||(t=e,A&&A in t))&&(O(e)?k:P).test(x(e));var t}function I(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return E(r)?r:void 0}var _=I(r,"WeakMap"),B=9007199254740991;function $(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=B}var D=Object.prototype;function N(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||D)}function R(e){return p(e)&&"[object Arguments]"==f(e)}var V=Object.prototype,W=V.hasOwnProperty,q=V.propertyIsEnumerable,C=R(function(){return arguments}())?R:function(e){return p(e)&&W.call(e,"callee")&&!q.call(e,"callee")};var z="object"==typeof exports&&exports&&!exports.nodeType&&exports,G=z&&"object"==typeof module&&module&&!module.nodeType&&module,K=G&&G.exports===z?r.Buffer:void 0,H=(K?K.isBuffer:void 0)||function(){return!1},J={};J["[object Float32Array]"]=J["[object Float64Array]"]=J["[object Int8Array]"]=J["[object Int16Array]"]=J["[object Int32Array]"]=J["[object Uint8Array]"]=J["[object Uint8ClampedArray]"]=J["[object Uint16Array]"]=J["[object Uint32Array]"]=!0,J["[object Arguments]"]=J["[object Array]"]=J["[object ArrayBuffer]"]=J["[object Boolean]"]=J["[object DataView]"]=J["[object Date]"]=J["[object Error]"]=J["[object Function]"]=J["[object Map]"]=J["[object Number]"]=J["[object Object]"]=J["[object RegExp]"]=J["[object Set]"]=J["[object String]"]=J["[object WeakMap]"]=!1;var L,Q="object"==typeof exports&&exports&&!exports.nodeType&&exports,X=Q&&"object"==typeof module&&module&&!module.nodeType&&module,Y=X&&X.exports===Q&&e.process,Z=function(){try{var e=X&&X.require&&X.require("util").types;return e||Y&&Y.binding&&Y.binding("util")}catch(e){}}(),ee=Z&&Z.isTypedArray,te=ee?(L=ee,function(e){return L(e)}):function(e){return p(e)&&$(e.length)&&!!J[f(e)]};var re=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),oe=Object.prototype.hasOwnProperty;var ne=I(r,"Map"),ce=I(r,"DataView"),ae=I(r,"Promise"),ie=I(r,"Set"),ue="[object Map]",le="[object Promise]",be="[object Set]",se="[object WeakMap]",fe="[object DataView]",pe=x(ce),ye=x(ne),je=x(ae),ve=x(ie),de=x(_),ge=f;(ce&&ge(new ce(new ArrayBuffer(1)))!=fe||ne&&ge(new ne)!=ue||ae&&ge(ae.resolve())!=le||ie&&ge(new ie)!=be||_&&ge(new _)!=se)&&(ge=function(e){var t=f(e),r="[object Object]"==t?e.constructor:void 0,o=r?x(r):"";if(o)switch(o){case pe:return fe;case ye:return ue;case je:return le;case ve:return be;case de:return se}return t});var me=ge,Oe=Object.prototype.hasOwnProperty;function he(e){if(null==e)return!0;if(function(e){return null!=e&&$(e.length)&&!O(e)}(e)&&(y(e)||"string"==typeof e||"function"==typeof e.splice||H(e)||te(e)||C(e)))return!e.length;var t=me(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(N(e))return!function(e){if(!N(e))return re(e);var t=[];for(var r in Object(e))oe.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e).length;for(var r in e)if(Oe.call(e,r))return!1;return!0}var we={id:"delete-editor",handler:async({keys:e,measureIds:t},{env:r,logger:o,accountability:n,services:c,getSchema:a})=>{if(he(Array.isArray(e)?e:[e]))throw new Error("No Keys for deletion");n.admin=!0;const{UsersService:i,ItemsService:u}=c,l=await a(),b=new i({schema:l,accountability:n}),s=new u("editors",{schema:l,accountability:n});let f=await s.readMany(e,{limit:-1});o.info("editors:");let p=[];for(const e of f){o.info(e);let t=await b.getUserByEmail(e.email);he(t)?o.info("User not found"):p.push(t.id)}he(p)||b.deleteMany(p)}};export{we as default};
