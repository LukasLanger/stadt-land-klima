name: "new measure Trigger CreateEmptyRating "
icon: bolt
color: null
description: triggers CreateEmptyRatings for each localteam  when a new measure
  is created and its status is published
status: active
trigger: event
accountability: all
options:
  type: action
  scope:
    - items.create
  collections:
    - measures
operations:
  - name: Trigger Flow
    key: trigger_v8atj
    type: trigger
    position_x: 25
    position_y: 37
    options:
      flow: 577761a3-ffda-4fbd-afe3-118e22a146d9
      payload: "{{$last.retData}}"
  - name: Read Data
    key: item_read_10gpj
    type: item-read
    position_x: 3
    position_y: 18
    options:
      collection: localteams
      query: null
    resolve_key: exec_x1cau
  - name: Run Script
    key: exec_x1cau
    type: exec
    position_x: 22
    position_y: 19
    options:
      code: |2-
         module.exports = async function(data) {
                    let retData = []
                	for (var i = 0; i < data["$last"].length; i++){
                  		retData.push({
                           "localteam_id":data["$last"][i]["id"],
                       		"measure_id": data["$trigger"]["key"]
                        })
                  	}
                    return {retData};
                }
    resolve_key: trigger_v8atj
  - name: Condition
    key: condition_xau12
    type: condition
    position_x: 22
    position_y: 1
    options:
      filter:
        $trigger:
          payload:
            status:
              _eq: published
    resolve_key: item_read_10gpj
operation_key: condition_xau12
